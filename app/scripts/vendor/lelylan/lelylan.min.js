"use strict",angular.module("lelylan",["lelylan.profile","lelylan.device","lelylan.history","lelylan.activation","lelylan.deactivation","lelylan.type","lelylan.property","lelylan.function","lelylan.status","lelylan.location","lelylan.subscription","lelylan.loggedUser","lelylan.accessToken","lelylan.requestWrapper","lelylan.basicAuth","lelylan.basicRequestWrapper","lelylan.implicitFlow","lelylan.config","lelylan.requests","lelylan.errors","lelylan.login"]),"use strict";var client=angular.module("lelylan.activation",["ngResource"]);client.factory("Activation",["RequestWrapper","$resource","lelylan.config",function(a,b,c){var d=b(c.endpoint+"/activations",{},{execute:{method:"POST"}});return a.wrap(d,["execute"])}]),"use strict";var client=angular.module("lelylan.deactivation",["ngResource"]);client.factory("Deactivation",["RequestWrapper","$resource","lelylan.config",function(a,b,c){var d=b(c.endpoint+"/activations/:activationCode",{activationCode:"@activation_code"},{execute:{method:"DELETE"}});return a.wrap(d,["execute"])}]),"use strict";var client=angular.module("lelylan.device",["ngResource"]);client.factory("Device",["RequestWrapper","$resource","lelylan.config",function(a,b,c){var d=b(c.endpoint+"/devices/:id/:action",{id:"@id"},{privates:{method:"GET",params:{action:"privates"}},update:{method:"PUT"},properties:{method:"PUT",params:{action:"properties"}},execute:{method:"PUT",params:{action:"functions"}}});return a.wrap(d,["get","privates","query","save","update","delete","properties","execute"])}]),"use strict";var client=angular.module("lelylan.function",["ngResource"]);client.factory("Function",["RequestWrapper","$resource","lelylan.config",function(a,b,c){var d=b(c.endpoint+"/functions/:id",{id:"@id"},{update:{method:"PUT"},"public":{method:"GET",params:{id:"public"},isArray:!0}});return a.wrap(d,["get","query","save","update","delete"])}]),"use strict";var client=angular.module("lelylan.history",["ngResource"]);client.factory("History",["RequestWrapper","$resource","lelylan.config",function(a,b,c){var d=b(c.endpoint+"/histories/:id",{id:"@id"});return a.wrap(d,["get","query"])}]),"use strict";var client=angular.module("lelylan.location",["ngResource"]);client.factory("Location",["RequestWrapper","$resource","lelylan.config",function(a,b,c){var d=b(c.endpoint+"/locations/:id",{id:"@id"},{update:{method:"PUT"}});return a.wrap(d,["get","query","save","update","delete"])}]),"use strict";var client=angular.module("lelylan.profile",["ngResource"]);client.factory("Profile",["RequestWrapper","$resource","lelylan.config","$timeout",function(a,b,c,d){var e,f=b(c.endpoint+"/me"),g=a.wrap(f,["get"]);return g}]),"use strict";var client=angular.module("lelylan.property",["ngResource"]);client.factory("Property",["RequestWrapper","$resource","lelylan.config",function(a,b,c){var d=b(c.endpoint+"/properties/:id",{id:"@id"},{update:{method:"PUT"},"public":{method:"GET",params:{id:"public"},isArray:!0}});return a.wrap(d,["get","query","save","update","delete"])}]),"use strict";var client=angular.module("lelylan.status",["ngResource"]);client.factory("Status",["RequestWrapper","$resource","lelylan.config",function(a,b,c){var d=b(c.endpoint+"/statuses/:id",{id:"@id"},{update:{method:"PUT"},"public":{method:"GET",params:{id:"public"},isArray:!0}});return a.wrap(d,["get","query","save","update","delete"])}]),"use strict";var client=angular.module("lelylan.subscription",["ngResource"]);client.factory("Subscription",["BasicRequestWrapper","$resource","lelylan.config",function(a,b,c){var d=b(c.endpoint+"/subscriptions/:id",{id:"@id"},{update:{method:"PUT"}});return a.wrap(d,["get","query","save","update","delete"])}]),"use strict";var client=angular.module("lelylan.type",["ngResource"]);client.factory("Type",["RequestWrapper","$resource","lelylan.config",function(a,b,c){var d=b(c.endpoint+"/types/:id",{id:"@id"},{update:{method:"PUT"},"public":{method:"GET",params:{id:"public"},isArray:!0}});return a.wrap(d,["get","query","save","update","delete"])}]),"use strict";var client=angular.module("lelylan.loggedUser",[]);client.factory("LoggedUser",["$location","$http",function(a,b){var c={},d={};return c.get=function(){return d},c.set=function(a){return d=a},c}]),"use strict";var client=angular.module("lelylan.basicRequestWrapper",["ngResource"]);client.factory("BasicRequestWrapper",["BasicAuth","Base64","$http",function(a,b,c){var d={};d.wrap=function(a,b,c){var d=a;for(var f=0;f<b.length;f++)e(d,b[f]);return d};var e=function(b,c){b["_"+c]=b[c],b[c]=function(d,e,h,i){return a.get().clientID&&a.get().clientSecret?f():g(),b["_"+c].call(this,d,e,h,i)}},f=function(){var d=a.get();c.defaults.headers.common.Authorization=b.encode(d.clientID+":"+d.clientSecret)},g=function(){delete c.defaults.headers.common.Authorization};return d}]),"use strict";var client=angular.module("lelylan.basicAuth",["ngResource"]);client.factory("BasicAuth",[function(){var a={},b={};return a.get=function(){return b},a.set=function(a){angular.extend(b,a)},a}]),client.factory("Base64",[function(){var a={},b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";a.encode=function(a){var b,d,a,e,f;d=a.length,e=0,f="";while(d>0)d>2?(b=a.substr(e,3),f+=c(b,3)):(b=a.substr(e,d),f+=c(b,d)),d-=3,e+=3;return f};var c=function(a,c){var d=new Array(4),e,f,g,h;return e=a.charCodeAt(0),d[0]=b.charAt(e>>2),c<2?(f=0,g=0,h=0):(f=a.charCodeAt(1),c<3?(g=0,h=0):(g=a.charCodeAt(2),h=a.charCodeAt(3))),d[1]=b.charAt((e&3)<<4|(f&240)>>4),c>1?d[2]=b.charAt((f&15)<<2|(g&192)>>6):d[2]="=",c>2?d[3]=b.charAt(g&63):d[3]="=",d[0]+d[1]+d[2]+d[3]};return a}]),"use strict";var client=angular.module("lelylan.requestWrapper",["ngResource"]);client.factory("RequestWrapper",["AccessToken","ImplicitFlow","$http",function(a,b,c){var d={},e;d.wrap=function(b,c,d){e=a.initialize();var g=b;for(var h=0;h<c.length;h++)f(g,c[h]);return g};var f=function(c,d){c["_"+d]=c[d],c[d]=function(f,i,j,k){return a.get().access_token?g():h(),e.expires_at&&e.expires_at<new Date&&window.location.replace(b.url()),c["_"+d].call(this,f,i,j,k)}},g=function(){c.defaults.headers.common.Authorization="Bearer "+e.access_token},h=function(){delete c.defaults.headers.common.Authorization};return d}]),"use strict";var client=angular.module("lelylan.accessToken",["ngResource"]);client.factory("AccessToken",["$location","$http",function(a,b){var c={},d={};c.get=function(){return d},c.initialize=function(){var a=c.parseToken();return a.access_token&&c.set(a),a.error&&c.set(a),d},c.set=function(a){return angular.extend(d,a),e(),d},c.delete=function(){d={}},c.parseToken=function(){var b={},c=a.hash().split("&");for(var d=0;d<c.length;d++){var e=c[d].split("="),f=e[0],g=e[1];b[f]=g}return b};var e=function(){var a=new Date;a.setSeconds(a.getSeconds()+parseInt(d.expires_in)-60),d.expires_at=a};return c}]),"use strict";var client=angular.module("lelylan.implicitFlow",["ngResource"]);client.factory("ImplicitFlow",["AccessToken","$location",function(a,b){var c={},d;c.url=function(a){return a&&(d=a),d.site+d.authorizePath+"?response_type=token&"+"client_id="+d.client+"&"+"redirect_uri="+d.redirect+"&"+"scope="+d.scope+"&"+"state="+d.state+e+i(b.url())},c.restoreURL=function(d){if(a.get().state){var f=a.get().state.split(e);f[0]&&a.set({state:f[0]}),f[1]&&b.url(j(f[1])),d.endpoint=c.url(d)}};var e="5c6007a2",f="e9e08740",g="008e974e",h="c1384ea1",i=function(a){return a.replace(/=/g,f).replace(/#/g,g).replace(/&/g,h)},j=function(a){return a.replace(/e9e08740/g,"=").replace(/008e974e/g,"#").replace(/c1384ea1/g,"&")};return c}]),angular.module("lelylan.errors",[]).config(["$httpProvider",function(a){var b={400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",420:"Enhance Your Calm",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",444:"No Response",449:"Retry With",499:"Client Closed Request",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"},c=["$rootScope","$q",function(a,c){function d(a){return a}function e(d){if(d.status>=400){var e={status:d.status,message:b[d.status]};a.$broadcast("lelylan:error",e),a.$broadcast("lelylan:error:"+d.status,e);var f=c.defer();return f.promise}return c.reject(d)}return function(a){return a.then(d,e)}}];a.responseInterceptors.push(c)}]),angular.module("lelylan.requests",[]).config(["$httpProvider",function(a){var b,c=["$q","$injector",function(a,c){function f(a){return b=b||c.get("$http"),b.pendingRequests.length<1&&e("lelylan-request-loading","none"),a}function d(d){return b=b||c.get("$http"),b.pendingRequests.length<1&&(e("lelylan-request-loading","none"),e("lelylan-request-error","none")),a.reject(d)}var d,e=function(a,b){window.document.getElementById(a)&&(window.document.getElementById(a).style.display=b)};return function(a){return e("lelylan-request-loading","block"),a.then(f,d)}}];a.responseInterceptors.push(c)}]),"use strict",angular.module("lelylan.config",[]).value("lelylan.config",{endpoint:"http://api.lelylan.com"}),"use strict";var directives=angular.module("lelylan.login",["ngCookies"]);directives.config(["$locationProvider",function(a){a.html5Mode(!0).hashPrefix("!")}]),directives.directive("login",["AccessToken","ImplicitFlow","Profile","LoggedUser","$location","$cookies","$rootScope",function(a,b,c,d,e,f,g){var h='<ul class="nav pull-right"><li ng-show="show==\'out\'" class="login"><a href="#" ng-href="{{endpoint}}">{{text}}</a></li><li ng-show="show==\'in\'" class="logout"><a href="#" ng-click="logout()">Logout {{profile.email}}</a></li></ul>',i={restrict:"E",replace:!0,transclude:!0,template:h,scope:{site:"@",client:"@",redirect:"@",scope:"@",state:"@",flow:"@",text:"@"}};return i.link=function(h,i,j){h.$watch("site",function(b){l();var c=a.initialize();if(c.access_token)return h.login();if(c.error)return h.deny();if(!o()&&!c.access_token&&!c.error)return h.logout();if(o()&&!c.access_token&&!c.error)return h.authorize()}),h.login=function(){m(),b.restoreURL(h),h.profile=d.set(c.get()),p("logged-in"),r()},h.logout=function(){k(),s()},h.deny=function(){k(),t()},h.authorize=function(){window.location.replace(h.endpoint)};var k=function(){n(),q(),h.profile=d.set(null),a.delete()},l=function(){h.site=h.site||"http://people.lelylan.com",h.flow=h.flow||"implicit",h.authorizePath=h.authorizePath||"/oauth/authorize",h.tokenPath=h.tokenPath||"/oauth/token",h.scope=h.scope||"user",h.endpoint=b.url(h)},m=function(){h.show="in"},n=function(){h.show="out"},o=function(){return f[h.client]},p=function(a){f[h.client]=a},q=function(){delete f[h.client]},r=function(){g.$broadcast("lelylan:login",a.get())},s=function(){g.$broadcast("lelylan:logout")},t=function(){g.$broadcast("lelylan:logout:denied")}},i}]);